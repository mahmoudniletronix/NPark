<div class="users-theme container-fluid" [class.page-rtl]="isRTL()" [attr.dir]="dir()">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0 fw-bold">{{ t('users') }}</h4>
    <button class="btn btn-primary" (click)="openAdd()">
      <i class="bi bi-plus-lg me-1"></i> {{ t('add_new') }}
    </button>
  </div>

  <div class="card shadow-soft mb-3">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-head">
            <tr>
              <th style="width: 80px">{{ t('id') }}</th>
              <th>{{ t('name') }}</th>
              <th>{{ t('email') }}</th>
              <th style="width: 120px">{{ t('role') }}</th>
              <th style="width: 110px">{{ t('status') }}</th>
              <th style="width: 120px">{{ t('actions') }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of users; trackBy: trackById">
              <td>{{ u.id }}</td>
              <td class="mono">{{ u.name }}</td>
              <td class="mono">{{ u.email }}</td>
              <td>
                <span class="badge theme-amber" *ngIf="u.role === 'Admin'">{{ t('admin') }}</span>
                <span class="badge theme-blue" *ngIf="u.role === 'User'">{{ t('user') }}</span>
              </td>
              <td>
                <span class="badge theme-green" *ngIf="u.active">{{ t('active') }}</span>
                <span class="badge bg-secondary" *ngIf="!u.active">{{ t('inactive') }}</span>
              </td>
              <td class="text-end">
                <button class="btn btn-sm btn-outline-primary me-2" (click)="openEdit(u)">
                  <i class="bi bi-pencil"></i> {{ t('edit') }}
                </button>
              </td>
            </tr>

            <tr *ngIf="!users.length && !loading">
              <td colspan="6" class="text-center text-muted py-4">{{ t('no_users') }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="loading" class="p-3 text-muted">{{ t('loading') }}</div>
    </div>
  </div>

  <!-- Inline Form Card -->
  <div class="card shadow-soft mb-4" *ngIf="showForm">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
      <strong>{{ isEdit ? t('edit_user') : t('add_user') }}</strong>
      <button class="btn btn-sm btn-outline-secondary" (click)="cancel()" [disabled]="saving">
        {{ t('close') }}
      </button>
    </div>

    <div class="card-body">
      <form (ngSubmit)="save()">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">{{ t('name') }}</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="model.name"
              name="name"
              required
              [disabled]="saving"
            />
          </div>

          <div class="col-md-4">
            <label class="form-label">{{ t('email') }}</label>
            <input
              type="email"
              class="form-control"
              [(ngModel)]="model.email"
              name="email"
              required
              [disabled]="saving"
            />
          </div>

          <div class="col-md-2">
            <label class="form-label">{{ t('role') }}</label>
            <select class="form-select" [(ngModel)]="model.role" name="role" [disabled]="saving">
              <option value="User">{{ t('user') }}</option>
              <option value="Admin">{{ t('admin') }}</option>
            </select>
          </div>

          <div class="col-md-2 d-flex align-items-end">
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="active"
                [(ngModel)]="model.active"
                name="active"
                [disabled]="saving"
              />
              <label for="active" class="form-check-label">{{ t('active') }}</label>
            </div>
          </div>
        </div>

        <div class="mt-3 d-flex align-items-center gap-2">
          <button class="btn btn-success" type="submit" [disabled]="saving">
            <i class="bi" [ngClass]="isEdit ? 'bi-save' : 'bi-plus-lg'"></i>
            {{ saving ? t('saving') : isEdit ? t('save') : t('create') }}
          </button>
          <button
            class="btn btn-outline-secondary"
            type="button"
            (click)="cancel()"
            [disabled]="saving"
          >
            {{ t('cancel') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
